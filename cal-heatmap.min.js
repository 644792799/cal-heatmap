var CalHeatMap=function(){function e(){var e=2*D.cellsize;return v=6*D.cellsize+6*D.cellpadding+D.cellpadding,w=10*D.cellsize+9*D.cellpadding+D.cellpadding,O=d3.select("#"+D.id+" .graph").selectAll().data(d3.time.hours(F,z).map(function(e){return e.getTime()})).enter().append("div").attr("class","hour").style("width",v+"px").style("height",w+e+"px").style("display","inline-block").append("svg:svg").attr("width",v).attr("height",w+e).append("svg:g").attr("transform","translate(0, 1)"),O.append("svg:text").attr("y",w+e/1.5).attr("class","graph-label").attr("text-anchor","middle").attr("vertical-align","middle").attr("x",v/2).text(function(e){var t=new Date(e);return t.getHours()+":00"}),T=O.selectAll("rect").data(function(e){return f(e)}).enter().append("svg:rect").attr("class","graph-rect").attr("width",D.cellsize).attr("height",D.cellsize).attr("x",function(e){var t=Math.floor(e.getMinutes()/10);return t*D.cellsize+t*D.cellpadding}).attr("y",function(e){var t=e.getMinutes()%10;return t*D.cellsize+t*D.cellpadding}),T.append("svg:title"),D.displayScale&&t(),D.loadOnInit&&d3.json(D.uri,function(e){n(a(e))}),!0}function t(){var e=d3.range(0,D.scales.length),t=d3.select("#"+D.id).append("svg:svg").attr("class","graph-scale").attr("height",D.cellsize+2*D.cellpadding);t.selectAll().data(e).enter().append("svg:rect").attr("width",D.cellsize).attr("height",D.cellsize).attr("class",function(e){return"graph-rect q"+(e+1)}).attr("transform",function(e){return"translate("+e*(D.cellsize+D.cellpadding)+", "+D.cellpadding+")"}).append("svg:title").text(function(e){var t=D.scales[e+1];return 0===e?0===t?"0 "+D.itemName[0]:"between 0 and "+(t-1)+" "+D.itemName[1]:e===D.scales.length-1?"more than "+D.scales[e]+" "+D.itemName[1]:D.scales[e]===t?D.scales[e]+" "+D.itemName[D.scales[e]>1?1:0]:"between "+D.scales[e]+" and "+(t-1)+" "+D.itemName[1]})}function n(e){O.each(function(t){d3.select(this).selectAll("rect").attr("class",function(n){var a=n.getMinutes();return D.start>n?"graph-rect q0":"graph-rect"+(e.hasOwnProperty(t)&&e[t].hasOwnProperty(a)?" "+r(e[t][a]):"")}).on("click",function(n){var a=n.getMinutes();return H(n,e.hasOwnProperty(t)&&e[t].hasOwnProperty(a)?e[t][a]:0)}).select("title").text(function(n){if(D.start>n)return"";var a=n.getMinutes();return(e.hasOwnProperty(t)&&e[t].hasOwnProperty(a)?x(e[t][a])+" "+D.itemName[e[t][a]>1?1:0]+" at ":"")+b(n)})})}function a(e){var t={};for(var n in e){var a=new Date(1e3*n),r=new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours());r=r.getTime()/1e3;var i=a.getMinutes();t[r]===void 0&&(t[r]={}),t[r][i]!==void 0?t[r][i]+=e[n]:t[r][i]=e[n]}return t}function r(e){for(var t=0,n=D.scales.length-1;n>t;t++)if(D.scales[t]>=e)return"q"+(t+1);return 0===e?"":"q"+D.scales.length}function i(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),0);return d3.time.minutes(t,new Date(t.getTime()+36e5))}function l(){}function s(){}function u(){}function c(){}function o(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),0);return[t,new Date(t.getTime()+36e5*D.range)]}function g(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0);return[t,new Date(t.getTime()+864e5*D.range)]}function d(e){var t=d3.time.monday(e);return[new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0),new Date(t.getTime()+6048e5)]}function h(e){var t=new Date(e.getFullYear(),e.getMonth(),1,0,0),n=0,a=0;return t.getMonth()+D.range>12?(n=t.getMonth()+D.range-12,a=D.range-n):n=D.range,[t,new Date(12>t.getMonth()?t.getFullYear():t.getFullYear()+1,0===a?t.getMonth()+D.range:t.getMonth()+D.range-12,0,0,0)]}function m(e){return[new Date(e.getFullYear(),0,1,0,0),new Date(e.getFullYear()+1,0,1,0,0)]}function p(e){switch("number"==typeof e&&(e=new Date(e)),D.domain){case"hour":return o(e);case"day":return g(e);case"week":return d(e);case"month":return h(e);case"year":return m(e)}}function f(e){switch("number"==typeof e&&(e=new Date(e)),D.subDomain){case"min":return i(e);case"hour":return l(e);case"day":return s(e);case"week":return u(e);case"month":return c(e)}}var v,w,D={id:"cal-heatmap",scales:[10,20,30,40],range:12,cellsize:10,cellpadding:2,dateFormat:"%H:%M, %A %B %e %Y",onClick:function(){},displayScale:!0,itemName:["item","items"],start:new Date,uri:"",loadOnInit:!0,domain:"hour",subDomain:"min"},M={hour:{},day:{},week:{},month:{},year:{}},y=p(D.start),F=y[0],Y=y[1],z=Y,b=d3.time.format(D.dateFormat),x=d3.format(",d"),O=null,T=null,H=function(e,t){D.onClick(new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),0),new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),59),t)};return{init:function(t){if(null!==t&&void 0!==t&&"undefined"!==t)for(var n in D)null!==t[n]&&void 0!==t[n]&&"undefined"!==t[n]&&(D[n]=t[n]);return""===D.uri&&(D.uri="/api/scheduled-jobs/stats/"+parseInt(D.start.getTime()/1e3,10)+"/"+parseInt(Y.getTime()/1e3,10)),M.hasOwnProperty(D.domain)?e():(console.log("The domain name is not valid"),!1)},getDomain:function(e){return p(e)},getSubDomain:function(e){return f(e)}}}();