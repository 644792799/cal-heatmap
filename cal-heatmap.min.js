var CalHeatMap=function(){function e(e){var t=D[v.subDomain].position.x(e);return t*v.cellsize+t*v.cellpadding}function t(e){var t=D[v.subDomain].position.y(e);return t*v.cellsize+t*v.cellpadding}function n(e){return D[v.domain].legendFormat(e)}function r(){var r=2*v.cellsize;return p=v.cellsize*D[v.subDomain].column()+v.cellpadding*D[v.subDomain].column()+v.cellpadding,w=v.cellsize*D[v.subDomain].row+v.cellpadding*D[v.subDomain].row+v.cellpadding,H=d3.select("#"+v.id+" .graph").selectAll().data(f(v.start).map(function(e){return e.getTime()})).enter().append("div").attr("class","hour").style("width",p+"px").style("height",w+r+"px").style("display","inline-block").append("svg:svg").attr("width",p).attr("height",w+r).append("svg:g").attr("transform","translate(0, 1)"),H.append("svg:text").attr("y",w+r/1.5).attr("class","graph-label").attr("text-anchor","middle").attr("vertical-align","middle").attr("x",p/2).text(function(e){var t=new Date(e);return n(t)}),z=H.selectAll("rect").data(function(e){return h(e)}).enter().append("svg:rect").attr("class","graph-rect").attr("width",v.cellsize).attr("height",v.cellsize).attr("x",function(t){return e(t)}).attr("y",function(e){return t(e)}),z.append("svg:title"),v.displayScale&&a(),v.loadOnInit&&d3.json(v.uri,function(e){o(i(e))}),!0}function a(){var e=d3.range(0,v.scales.length),t=d3.select("#"+v.id).append("svg:svg").attr("class","graph-scale").attr("height",v.cellsize+2*v.cellpadding);t.selectAll().data(e).enter().append("svg:rect").attr("width",v.cellsize).attr("height",v.cellsize).attr("class",function(e){return"graph-rect q"+(e+1)}).attr("transform",function(e){return"translate("+e*(v.cellsize+v.cellpadding)+", "+v.cellpadding+")"}).append("svg:title").text(function(e){var t=v.scales[e+1];return 0===e?0===t?"0 "+v.itemName[0]:"between 0 and "+(t-1)+" "+v.itemName[1]:e===v.scales.length-1?"more than "+v.scales[e]+" "+v.itemName[1]:v.scales[e]===t?v.scales[e]+" "+v.itemName[v.scales[e]>1?1:0]:"between "+v.scales[e]+" and "+(t-1)+" "+v.itemName[1]})}function o(e){H.each(function(t){t/=1e3,d3.select(this).selectAll("rect").attr("class",function(n){var r=n.getMinutes();return v.start>n?"graph-rect q0":"graph-rect"+(e.hasOwnProperty(t)&&e[t].hasOwnProperty(r)?" "+l(e[t][r]):"")}).on("click",function(n){var r=n.getMinutes();return A(n,e.hasOwnProperty(t)&&e[t].hasOwnProperty(r)?e[t][r]:0)}).select("title").text(function(n){if(v.start>n)return"";var r=n.getMinutes();return(e.hasOwnProperty(t)&&e[t].hasOwnProperty(r)?x(e[t][r])+" "+v.itemName[e[t][r]>1?1:0]+" at ":"")+b(n)})})}function i(e){var t={};for(var n in e){var r=new Date(1e3*n),a=new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours());a=a.getTime()/1e3;var o=r.getMinutes();t[a]===void 0&&(t[a]={}),t[a][o]!==void 0?t[a][o]+=e[n]:t[a][o]=e[n]}return t}function l(e){for(var t=0,n=v.scales.length-1;n>t;t++)if(v.scales[t]>=e)return"q"+(t+1);return 0===e?"":"q"+v.scales.length}function u(e,t){var n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),0);return d3.time.minutes(n,new Date(n.getTime()+36e5*t))}function s(e,t){var n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),0);return d3.time.hours(n,new Date(n.getTime()+36e5*t))}function c(e,t){var n=new Date(e.getFullYear(),e.getMonth(),1,0,0);return d3.time.days(n,new Date(n.getTime()+864e5*t))}function d(e){var t=d3.time.monday(e);return[new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0),new Date(t.getTime()+6048e5)]}function g(e,t){var n=new Date(e.getFullYear(),e.getMonth(),1,0,0),r=new Date(n);return r=r.setMonth(r.getMonth()+t),d3.time.months(n,r)}function m(e){return d3.time.years(new Date(e.getFullYear(),0,1,0,0),new Date(e.getFullYear()+1,0,1,0,0))}function f(e){switch("number"==typeof e&&(e=new Date(e)),v.domain){case"hour":return s(e,v.range);case"day":return c(e,v.range);case"week":return d(e,v.range);case"month":return g(e,v.range);case"year":return m(e,v.range)}}function h(e){switch("number"==typeof e&&(e=new Date(e)),v.subDomain){case"min":return u(e,1);case"hour":return s(e,24);case"day":return c(e,"year"===v.domain?365:30);case"week":return d(e,1);case"month":return g(e,12)}}var p,w,v={id:"cal-heatmap",scales:[10,20,30,40],range:12,cellsize:10,cellpadding:2,dateFormat:"%H:%M, %A %B %e %Y",legendFormat:"%H:%M",onClick:function(){},displayScale:!0,itemName:["item","items"],start:new Date,uri:"",loadOnInit:!0,domain:"hour",subDomain:"min"},y=d3.time.format("%j"),D={min:{row:10,column:function(){return 6},position:{x:function(e){return Math.floor(e.getMinutes()/D.min.row)},y:function(e){return e.getMinutes()%D.min.row}},dateFormat:"%H:%M, %A %B %e %Y",legendFormat:d3.time.format("")},hour:{row:6,column:function(){return 4},position:{x:function(e){return Math.floor(e.getHours()/D.hour.row)},y:function(e){return e.getHours()%D.hour.row}},dateFormat:"%H, %A %B %e %Y",legendFormat:d3.time.format("%H:00")},day:{row:7,column:function(){return"year"===v.domain?55:5},position:{x:function(e){return Math.floor(("year"===v.domain?y(e):e.getDate())/D.day.row)},y:function(e){return("year"===v.domain?y(e):e.getDate())%D.day.row}},dateFormat:"%H, %A %B %e %Y",legendFormat:d3.time.format("%e")},week:{},month:{row:1,column:function(){return 12},position:{x:function(e){return Math.floor(e.getMonth()/D.month.row)},y:function(e){return e.getMonth()%D.month.row}},dateFormat:"%H, %A %B %e %Y",legendFormat:d3.time.format("%B")},year:{row:1,column:function(){return 12},position:{x:function(e){return Math.floor(e.getFullYear()/D.year.row)},y:function(e){return e.getFullYear()%D.year.row}},dateFormat:"%Y",legendFormat:d3.time.format("%Y")}},M=null,F=null,Y=F,b=d3.time.format(v.dateFormat),x=d3.format(",d"),H=null,z=null,A=function(e,t){v.onClick(new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),0),new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),59),t)};return{init:function(e){if(null!==e&&void 0!==e&&"undefined"!==e)for(var t in v)null!==e[t]&&void 0!==e[t]&&"undefined"!==e[t]&&(v[t]=e[t]);var n=f(v.start);return M=n[0],F=n[n.length-1],Y=F,""===v.uri&&(v.uri="/api/scheduled-jobs/stats/"+parseInt(v.start.getTime()/1e3,10)+"/"+parseInt(F.getTime()/1e3,10)),D.hasOwnProperty(v.domain)?r():(console.log("The domain name is not valid"),!1)},getDomain:function(e){return f(e)},getSubDomain:function(e){return h(e)}}}();